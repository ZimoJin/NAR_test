<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlap Extension PCR - PrimerWeaver</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            color: #333;
            background: #f9fafb;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e40af;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #2563eb;
            margin-top: 2em;
            margin-bottom: 1em;
            font-size: 1.5em;
        }
        h3 {
            color: #3b82f6;
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            font-size: 1.2em;
        }
        h4 {
            color: #60a5fa;
            margin-top: 1.2em;
            margin-bottom: 0.6em;
        }
        p {
            margin-bottom: 1em;
            text-align: justify;
        }
        ul, ol {
            margin-left: 25px;
            margin-bottom: 1em;
        }
        li {
            margin-bottom: 0.5em;
        }
        strong {
            color: #1e40af;
            font-weight: 600;
        }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #c2410c;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1em 0;
        }
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f1f5f9;
            color: #1e40af;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8fafc;
        }
        .abstract {
            background: #eff6ff;
            border-left: 4px solid #2563eb;
            padding: 20px;
            margin: 2em 0;
            border-radius: 4px;
        }
        .abstract p {
            margin: 0;
            font-style: italic;
        }
        .section {
            margin-bottom: 2.5em;
        }
        .math-block {
            background: #f8fafc;
            border-left: 3px solid #3b82f6;
            padding: 12px 16px;
            margin: 1em 0;
            font-family: 'Times New Roman', serif;
            font-size: 1.1em;
        }
        .warning-box {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 16px;
            margin: 1.5em 0;
            border-radius: 4px;
        }
        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 16px;
            margin: 1.5em 0;
            border-radius: 4px;
        }
        .version-info {
            text-align: center;
            color: #64748b;
            font-size: 0.9em;
            margin-top: 3em;
            padding-top: 2em;
            border-top: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Overlap Extension PCR (OE-PCR) Primer Designer</h1>
        
        <div class="abstract">
            <p>The Overlap Extension PCR module enables seamless assembly of multiple DNA fragments through rational design of primers containing complementary overlap regions. The tool automatically designs primer pairs for each fragment, incorporating user-specified linker sequences (DNA or amino acid) between fragments, while optimizing overlap length and melting temperature for efficient assembly. This method is particularly suited for constructing fusion proteins, joining modular genetic elements, and creating chimeric sequences without restriction enzyme sites.</p>
        </div>

        <div class="section">
            <h2>Quick Start Guide</h2>
            <ol>
                <li><strong>Input Sequences:</strong> Add 2 or more DNA fragments in the desired order. FASTA format is supported, and sequence names will be auto-extracted from headers.</li>
                <li><strong>Specify Linkers (Optional):</strong> Click "Show Linker" to add linker sequences between fragments. Linkers can be entered as DNA or amino acid sequences (AA will be converted using host organism codon preferences).</li>
                <li><strong>Adjust Parameters:</strong> Set target melting temperatures for core primers (50-65°C) and overlap regions (50-65°C). Adjust salt concentrations if needed.</li>
                <li><strong>Optional Terminal Sequences:</strong> Add custom sequences to the 5' ends of F1 and RN primers (e.g., restriction sites, tags).</li>
                <li><strong>Design Primers:</strong> Click "Design Primers" to generate optimized primer sequences.</li>
                <li><strong>Review Results:</strong> Examine primer sequences, melting temperatures, and quality metrics. Download the assembled sequence with highlighted primer binding regions.</li>
            </ol>
        </div>

        <div class="section">
            <h2>Features</h2>

            <h3>1. Multi-Fragment Assembly</h3>
            <p>Design primers to assemble 2-10 DNA fragments in a single workflow. The module supports:</p>
            <ul>
                <li>Sequential joining of fragments with automatic overlap design</li>
                <li>FASTA format input with automatic name extraction</li>
                <li>Flexible fragment reordering (move up/down, flip order)</li>
                <li>Batch upload and demo sequences for testing</li>
            </ul>

            <h3>2. Linker Sequence Integration</h3>
            <p>Insert linker sequences between fragments for:</p>
            <ul>
                <li><strong>DNA Linkers:</strong> Direct insertion of nucleotide sequences (e.g., restriction sites, flexible linkers)</li>
                <li><strong>Amino Acid Linkers:</strong> Common protein linkers (GS, G4S, EAAAK, etc.) automatically converted to DNA using host organism codon preferences</li>
                <li><strong>Fusion Tags:</strong> His-tag, FLAG-tag, HA-tag, Strep-tag, and other affinity tags</li>
                <li><strong>Multiple Organism Support:</strong> Codon optimization for E. coli, yeast, mammalian cells, plants, and more</li>
            </ul>

            <div class="info-box">
                <strong>Linker Suggestions:</strong> The module provides a dropdown list of commonly used linkers including flexible (GS)n and (G4S)n linkers, rigid EAAAK linkers, and various affinity tags. Custom sequences are also supported.
            </div>

            <h3>3. Intelligent Overlap Design</h3>
            <p>The module employs two strategies for overlap design based on linker length:</p>

            <h4>Long Linker Strategy (≥25 bp)</h4>
            <p>When the linker is sufficiently long, the overlap region is positioned <em>within</em> the linker itself for economy:</p>
            <ul>
                <li>Overlap consists of a central portion of the linker (20-30 bp)</li>
                <li>Minimal flanking sequences from adjacent fragments (9-15 bp each)</li>
                <li>Minimizes primer length while maintaining sufficient overlap for annealing</li>
                <li>Formula: <code>Overlap = leftPart + linkerMiddle + rightPart</code></li>
            </ul>

            <h4>Short Linker Strategy (<25 bp)</h4>
            <p>For short or absent linkers, the overlap spans the linker plus flanking sequences:</p>
            <ul>
                <li>Overlap extends from fragment 1 end through linker to fragment 2 start</li>
                <li>Ensures minimum overlap length (18 bp) is achieved</li>
                <li>Balances left and right extensions for optimal annealing</li>
                <li>Formula: <code>Overlap = fragment1End + linker + fragment2Start</code></li>
            </ul>

            <div class="info-box">
                <strong>Empty Linker Handling:</strong> When no linker is specified (length = 0), the short linker strategy directly connects fragments by taking sequences from their ends, creating a seamless junction without intermediate bases.
            </div>

            <h3>4. Primer Design Algorithm</h3>

            <h4>Core Primer Design</h4>
            <p>Core primers bind to the template DNA with the following characteristics:</p>
            <ul>
                <li><strong>Forward Primers (F):</strong> Designed from the 5' start of each fragment</li>
                <li><strong>Reverse Primers (R):</strong> Designed from the 3' end of each fragment (reverse complemented)</li>
                <li><strong>Length Optimization:</strong> 18-40 bp adjusted to match target Tm</li>
                <li><strong>Always Complete:</strong> Core primers utilize the full fragment sequence from the binding point, never excluding fragment bases</li>
            </ul>

            <h4>Overlap Extension Primers</h4>
            <p>Connection primers contain both core and overlap regions:</p>
            <ul>
                <li><strong>R1 (Fragment i → i+1):</strong> Reverse primer with overlap to next fragment</li>
                <li><strong>F2 (Fragment i+1 ← i):</strong> Forward primer with overlap from previous fragment</li>
                <li><strong>Structure:</strong> 
                    <ul>
                        <li>Long linker: <code>R1 = core + linkerFront</code>, <code>F2 = linkerBack + core</code></li>
                        <li>Short linker: <code>R1 = core + halfLinker + rightPart</code>, <code>F2 = leftPart + halfLinker + core</code></li>
                    </ul>
                </li>
            </ul>

            <h4>Terminal Primers</h4>
            <ul>
                <li><strong>F1:</strong> Forward primer for first fragment, optional 5' overhang for cloning sites</li>
                <li><strong>RN:</strong> Reverse primer for last fragment, optional 5' overhang (reverse complemented)</li>
                <li><strong>Custom Sequences:</strong> User-provided terminal sequences do not participate in Tm calculation</li>
            </ul>

            <h3>5. Thermodynamic Calculations</h3>

            <h4>Melting Temperature (Tm)</h4>
            <p>Primer Tm is calculated using the nearest-neighbor thermodynamic model with salt correction:</p>
            <div class="math-block">
                Tm = ΔH° / (ΔS° + R × ln(C<sub>T</sub>/4)) - 273.15 + 16.6 × log[Na<sup>+</sup><sub>eq</sub>]
            </div>
            <p>Where:</p>
            <ul>
                <li>ΔH° and ΔS° are calculated from nearest-neighbor parameters (SantaLucia 1998)</li>
                <li>C<sub>T</sub> is total primer concentration (default 500 nM)</li>
                <li>Na<sup>+</sup><sub>eq</sub> includes Mg<sup>2+</sup> effect: [Na<sup>+</sup><sub>eq</sub>] = [Na<sup>+</sup>] + 4√[Mg<sup>2+</sup>]</li>
                <li>R is the gas constant (1.987 cal/mol·K)</li>
            </ul>

            <h4>Separate Tm Reporting</h4>
            <p>The module reports two distinct Tm values for each primer:</p>
            <ul>
                <li><strong>Core Tm:</strong> Melting temperature of the template-binding region only</li>
                <li><strong>Overlap Tm:</strong> Melting temperature of the fragment-to-fragment overlap region</li>
                <li>This dual reporting helps optimize PCR conditions for both template amplification and fragment assembly steps</li>
            </ul>

            <h3>6. Quality Control Metrics</h3>
            <p>Each primer is evaluated for:</p>
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Description</th>
                        <th>Optimal Range</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Length</td>
                        <td>Total primer length including overlap</td>
                        <td>25-60 bp</td>
                    </tr>
                    <tr>
                        <td>GC Content</td>
                        <td>Percentage of G and C bases</td>
                        <td>40-60%</td>
                    </tr>
                    <tr>
                        <td>Core Tm</td>
                        <td>Template binding region Tm</td>
                        <td>50-65°C</td>
                    </tr>
                    <tr>
                        <td>Overlap Tm</td>
                        <td>Fragment overlap region Tm</td>
                        <td>50-65°C</td>
                    </tr>
                    <tr>
                        <td>Homopolymer</td>
                        <td>Runs of identical bases</td>
                        <td>&lt;4 consecutive</td>
                    </tr>
                    <tr>
                        <td>Hairpin</td>
                        <td>Intramolecular secondary structure</td>
                        <td>ΔG &gt; -3 kcal/mol</td>
                    </tr>
                    <tr>
                        <td>Self-dimer</td>
                        <td>Primer self-complementarity</td>
                        <td>ΔG &gt; -5 kcal/mol</td>
                    </tr>
                    <tr>
                        <td>Cross-dimer</td>
                        <td>F/R primer complementarity</td>
                        <td>ΔG &gt; -5 kcal/mol</td>
                    </tr>
                </tbody>
            </table>

            <div class="warning-box">
                <strong>Warning:</strong> Primers with strong secondary structures (ΔG ≤ -7 kcal/mol) or extensive 3'-end interactions are flagged as "BAD" and may lead to PCR failure or spurious products.
            </div>

            <h3>7. Results Visualization</h3>

            <h4>Assembled Sequence Display</h4>
            <ul>
                <li><strong>FASTA Format:</strong> Complete assembled sequence with automatic header generation</li>
                <li><strong>Primer Highlighting:</strong> Core binding regions are underlined in the sequence
                    <ul>
                        <li>F1: Single underline</li>
                        <li>R1: Double underline</li>
                        <li>F2: Dotted underline</li>
                        <li>RN: Wavy underline</li>
                        <li>Overlapping regions show combined styles</li>
                    </ul>
                </li>
                <li><strong>Download Option:</strong> Save assembled sequence as FASTA file with sanitized filename</li>
                <li><strong>Length Information:</strong> Total length and number of linkers included</li>
            </ul>

            <h4>Primer Table</h4>
            <p>Comprehensive table showing all primers with:</p>
            <ul>
                <li>Primer sequence with <strong><em>overlap regions in bold italic</em></strong></li>
                <li>Length, GC%, Core Tm, and Overlap Tm</li>
                <li>Quality badges (OK, Warn, Bad) for homopolymers, hairpins, self-dimers</li>
                <li>Cross-dimer analysis for each fragment pair</li>
                <li>Fragment-specific color coding for easy identification</li>
            </ul>
        </div>

        <div class="section">
            <h2>Usage Parameters</h2>

            <h3>Core Parameters</h3>
            <table>
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Default</th>
                        <th>Range</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Core Primer Tm</td>
                        <td>55°C</td>
                        <td>40-80°C</td>
                        <td>Target Tm for template-binding region</td>
                    </tr>
                    <tr>
                        <td>Overlap Tm</td>
                        <td>55°C</td>
                        <td>40-80°C</td>
                        <td>Target Tm for fragment overlap region</td>
                    </tr>
                    <tr>
                        <td>Primer Conc.</td>
                        <td>500 nM</td>
                        <td>50-2000 nM</td>
                        <td>Primer concentration in PCR reaction</td>
                    </tr>
                    <tr>
                        <td>Na<sup>+</sup></td>
                        <td>50 mM</td>
                        <td>0-200 mM</td>
                        <td>Monovalent cation concentration</td>
                    </tr>
                    <tr>
                        <td>Mg<sup>2+</sup></td>
                        <td>2.0 mM</td>
                        <td>0-10 mM</td>
                        <td>Divalent cation concentration</td>
                    </tr>
                </tbody>
            </table>

            <h3>Optional Parameters</h3>
            <table>
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Purpose</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>F Overlap Sequence</td>
                        <td>5' overhang for F1 primer</td>
                        <td>GGGGAATTCC (EcoRI site)</td>
                    </tr>
                    <tr>
                        <td>R Overlap Sequence</td>
                        <td>5' overhang for RN primer (will be RC'd)</td>
                        <td>GGCCGGATCC (BamHI site)</td>
                    </tr>
                    <tr>
                        <td>Linker Sequences</td>
                        <td>Junction sequences between fragments</td>
                        <td>GSGSGS (flexible linker)</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <strong>Note on Terminal Sequences:</strong> Forward and reverse overlap sequences are added to the 5' ends of F1 and RN primers respectively. These sequences do not participate in Tm calculations, which are based solely on the core primer regions.
            </div>
        </div>

        <div class="section">
            <h2>Codon Optimization</h2>

            <h3>Supported Organisms</h3>
            <p>When using amino acid linkers, sequences are automatically optimized for:</p>

            <h4>Bacteria</h4>
            <ul>
                <li>Escherichia coli K-12</li>
                <li>Bacillus subtilis</li>
                <li>Corynebacterium glutamicum</li>
            </ul>

            <h4>Yeasts & Fungi</h4>
            <ul>
                <li>Saccharomyces cerevisiae S288C (default)</li>
                <li>Pichia pastoris (Komagataella phaffii)</li>
                <li>Yarrowia lipolytica</li>
            </ul>

            <h4>Mammals & Cell Lines</h4>
            <ul>
                <li>Homo sapiens</li>
                <li>Mus musculus</li>
                <li>Cricetulus griseus (CHO)</li>
                <li>HEK293</li>
            </ul>

            <h4>Plants</h4>
            <ul>
                <li>Arabidopsis thaliana</li>
                <li>Oryza sativa (Rice)</li>
                <li>Nicotiana benthamiana</li>
            </ul>

            <h3>Codon Selection Algorithm</h3>
            <p>To avoid repetitive sequences (e.g., GGTGGTGGTGGT for GGGG), the module uses a round-robin strategy:</p>
            <ul>
                <li>For each amino acid, selects from the top 2-3 preferred codons</li>
                <li>Rotates through available codons to maximize sequence diversity</li>
                <li>Maintains codon usage preferences from the Kazusa database</li>
                <li>Prevents long homopolymer runs while respecting organism preferences</li>
            </ul>

            <div class="info-box">
                <strong>Example:</strong> For the sequence "GGGG" in E. coli:
                <ul>
                    <li>Traditional single-codon: <code>GGTGGTGGTGGT</code> (repetitive)</li>
                    <li>Round-robin approach: <code>GGTGGCGGTGGC</code> (diverse, maintains preference)</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>Practical Applications</h2>

            <h3>1. Fusion Protein Construction</h3>
            <p>Create fusion proteins with flexible or rigid linkers between domains:</p>
            <ul>
                <li>Add protein domains as separate fragments</li>
                <li>Insert appropriate linker (e.g., (G4S)3 for flexibility)</li>
                <li>Design primers automatically optimize overlap regions</li>
                <li>Perform OE-PCR to generate full-length fusion construct</li>
            </ul>

            <h3>2. Domain Shuffling</h3>
            <p>Rearrange or swap functional domains:</p>
            <ul>
                <li>Input domains in desired order</li>
                <li>Add minimal or no linkers for direct fusion</li>
                <li>Use "Flip Order" to test alternative arrangements</li>
                <li>Compare assembly efficiency with different configurations</li>
            </ul>

            <h3>3. Tagged Protein Expression</h3>
            <p>Add N- or C-terminal tags for purification or detection:</p>
            <ul>
                <li>N-terminal: Add tag sequence as first fragment or use F overlap</li>
                <li>C-terminal: Add tag as last fragment or specify in linker</li>
                <li>Common tags available in linker suggestions (His, FLAG, HA, Strep)</li>
                <li>Optimize codon usage for expression host</li>
            </ul>

            <h3>4. Restriction-Free Cloning</h3>
            <p>Assemble fragments without restriction sites:</p>
            <ul>
                <li>Add restriction sites via F/R overlap sequences</li>
                <li>Join internal fragments without site requirements</li>
                <li>Avoid internal site conflicts in coding sequences</li>
                <li>Download assembled sequence for validation</li>
            </ul>

            <h3>5. Multi-Gene Assembly</h3>
            <p>Create polycistronic constructs or gene clusters:</p>
            <ul>
                <li>Input multiple genes in order</li>
                <li>Add ribosome binding sites or 2A peptides as linkers</li>
                <li>Maintain proper spacing between elements</li>
                <li>Verify assembled sequence before synthesis</li>
            </ul>
        </div>

        <div class="section">
            <h2>PCR Strategy</h2>

            <h3>Two-Step OE-PCR Protocol</h3>

            <h4>Step 1: Fragment Amplification</h4>
            <p>Amplify each fragment with its specific primer pair:</p>
            <ul>
                <li><strong>Fragment 1:</strong> F1 + R1</li>
                <li><strong>Fragment 2:</strong> F2 + R2</li>
                <li><strong>Fragment N:</strong> FN + RN</li>
            </ul>
            <p>PCR conditions:</p>
            <ul>
                <li>Use standard annealing temperature based on Core Tm (typically Tm - 5°C)</li>
                <li>Extension time: 1 min/kb</li>
                <li>Purify products after amplification</li>
            </ul>

            <h4>Step 2: Overlap Extension</h4>
            <p>Combine purified fragments for assembly:</p>
            <ul>
                <li>Mix all fragments in equimolar ratio</li>
                <li>Perform extension cycles without primers (5-10 cycles)</li>
                <li>Add F1 and RN primers for final amplification (20-25 cycles)</li>
                <li>Use annealing temperature based on Overlap Tm</li>
            </ul>

            <h3>Recommended PCR Conditions</h3>
            <table>
                <thead>
                    <tr>
                        <th>Step</th>
                        <th>Temperature</th>
                        <th>Time</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Initial Denaturation</td>
                        <td>95°C</td>
                        <td>3 min</td>
                        <td>Both steps</td>
                    </tr>
                    <tr>
                        <td>Denaturation</td>
                        <td>95°C</td>
                        <td>30 sec</td>
                        <td>Both steps</td>
                    </tr>
                    <tr>
                        <td>Annealing (Step 1)</td>
                        <td>Core Tm - 5°C</td>
                        <td>30 sec</td>
                        <td>Template binding</td>
                    </tr>
                    <tr>
                        <td>Annealing (Step 2)</td>
                        <td>Overlap Tm - 3°C</td>
                        <td>45 sec</td>
                        <td>Fragment overlap</td>
                    </tr>
                    <tr>
                        <td>Extension</td>
                        <td>72°C</td>
                        <td>1 min/kb</td>
                        <td>Both steps</td>
                    </tr>
                    <tr>
                        <td>Final Extension</td>
                        <td>72°C</td>
                        <td>10 min</td>
                        <td>Both steps</td>
                    </tr>
                </tbody>
            </table>

            <div class="warning-box">
                <strong>Troubleshooting Tips:</strong>
                <ul>
                    <li>If assembly fails: Increase overlap Tm or extend annealing time in Step 2</li>
                    <li>For GC-rich regions: Add DMSO (3-5%) or use GC-rich polymerase</li>
                    <li>Multiple bands: Reduce fragment concentration or optimize ratios</li>
                    <li>Low yield: Increase cycles in Step 2 or optimize primer ratio</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>Algorithm Details</h2>

            <h3>Overlap Design Algorithm</h3>

            <h4>Strategy Selection</h4>
            <pre><code>if linkerLength >= 25:
    use LONG_LINKER_STRATEGY
else:
    use SHORT_LINKER_STRATEGY</code></pre>

            <h4>Long Linker Strategy</h4>
            <p>Optimize for economy by placing overlap within the linker:</p>
            <pre><code>for overlapLen in [minOverlap...maxOverlap]:
    for linkerStart in [centered_positions]:
        linkerOverlap = linker[linkerStart : linkerStart + overlapLen]
        
        # Extract left and right parts from linker itself
        linkerCenter = linkerLength / 2
        leftPart = linker[linkerCenter - leftLen : linkerCenter]
        rightPart = linker[linkerCenter : linkerCenter + rightLen]
        
        overlapSeq = leftPart + linkerOverlap + rightPart
        tm = calculate_tm(overlapSeq)
        
        if tm >= minOverlapTm:
            score = |tm - targetTm| + length_penalty
            if score < best_score:
                best = {seq, leftLen, rightLen, linkerStart, tm}</code></pre>

            <h4>Short Linker Strategy</h4>
            <p>Extend overlap across linker boundaries into fragments:</p>
            <pre><code>linkerCenter = linkerLength / 2

for leftLen in [9...15]:
    for rightLen in [9...15]:
        totalLen = leftLen + linkerLength + rightLen
        if totalLen < minOverlap:
            continue
        
        # Build leftPart: may extend into fragment1End
        if linkerCenter < leftLen:
            takeFromFragment = leftLen - linkerCenter
            leftPart = fragment1End[-takeFromFragment:] + linker[:linkerCenter]
        else:
            leftPart = linker[linkerCenter - leftLen : linkerCenter]
        
        # Build rightPart: may extend into fragment2Start
        if (linkerLength - linkerCenter) < rightLen:
            takeFromFragment = rightLen - (linkerLength - linkerCenter)
            rightPart = linker[linkerCenter:] + fragment2Start[:takeFromFragment]
        else:
            rightPart = linker[linkerCenter : linkerCenter + rightLen]
        
        overlapSeq = leftPart + linker + rightPart
        tm = calculate_tm(overlapSeq)
        
        if tm >= minOverlapTm:
            score = |tm - targetTm| + balance_penalty + length_penalty
            if score < best_score:
                best = {seq, leftLen, rightLen, tm}</code></pre>

            <h4>Core Primer Design</h4>
            <p>Design template-binding regions for each fragment:</p>
            <pre><code>def designCore(sequence, isForward, targetTm):
    if isForward:
        # Forward: extend from start until target Tm reached
        for len in [minLen...maxLen]:
            coreSeq = sequence[:len]
            tm = calculate_tm(coreSeq)
            if |tm - targetTm| is minimal:
                return {seq: coreSeq, len: len, tm: tm}
    else:
        # Reverse: extend from end (will be RC'd)
        for len in [minLen...maxLen]:
            coreSeq = sequence[-len:]
            tm = calculate_tm(coreSeq)
            if |tm - targetTm| is minimal:
                return {seq: coreSeq, len: len, tm: tm}</code></pre>

            <h4>Connection Primer Assembly</h4>
            <p>Combine core and overlap regions:</p>
            <pre><code># R1 primer (reverse for fragment i, connects to i+1)
r1Core = designCore(fragment_i, isForward=False, targetTm)

if LONG_LINKER:
    r1Overlap = linker[:linkerStart + overlapLen]
else:
    if linkerLength > 0:
        r1Overlap = linker[:linkerCenter] + rightPart
    else:
        r1Overlap = rightPart

R1_forward = r1Core.seq + r1Overlap
R1 = reverse_complement(R1_forward)

# F2 primer (forward for fragment i+1, connects from i)
f2Core = designCore(fragment_i+1, isForward=True, targetTm)

if LONG_LINKER:
    f2Overlap = linker[linkerStart:]
else:
    if linkerLength > 0:
        f2Overlap = leftPart + linker[linkerCenter:]
    else:
        f2Overlap = leftPart

F2 = f2Overlap + f2Core.seq</code></pre>
        </div>

        <div class="section">
            <h2>Technical Notes</h2>

            <h3>Thermodynamic Model</h3>
            <p>The module uses the nearest-neighbor (NN) thermodynamic model (SantaLucia 1998) for accurate Tm prediction:</p>
            <ul>
                <li><strong>Enthalpy (ΔH°):</strong> Sum of nearest-neighbor stacking interactions</li>
                <li><strong>Entropy (ΔS°):</strong> Accounts for conformational changes and salt effects</li>
                <li><strong>Salt Correction:</strong> Adjusts for monovalent (Na+) and divalent (Mg2+) cations</li>
                <li><strong>Concentration Effect:</strong> Considers primer concentration in duplex formation</li>
            </ul>

            <h3>Quality Control Thresholds</h3>
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>OK</th>
                        <th>Warn</th>
                        <th>Bad</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Primer Length</td>
                        <td>25-60 bp</td>
                        <td>20-25 or 60-70 bp</td>
                        <td>&lt;20 or &gt;70 bp</td>
                    </tr>
                    <tr>
                        <td>GC Content</td>
                        <td>40-60%</td>
                        <td>30-40% or 60-70%</td>
                        <td>&lt;30% or &gt;70%</td>
                    </tr>
                    <tr>
                        <td>Tm Deviation</td>
                        <td>±3°C</td>
                        <td>±3-5°C</td>
                        <td>&gt;±5°C</td>
                    </tr>
                    <tr>
                        <td>Hairpin ΔG</td>
                        <td>&gt; -3 kcal/mol</td>
                        <td>-5 to -3 kcal/mol</td>
                        <td>&lt; -5 kcal/mol</td>
                    </tr>
                    <tr>
                        <td>Dimer ΔG</td>
                        <td>&gt; -5 kcal/mol</td>
                        <td>-7 to -5 kcal/mol</td>
                        <td>&lt; -7 kcal/mol</td>
                    </tr>
                    <tr>
                        <td>Homopolymer</td>
                        <td>&lt;4 bases</td>
                        <td>4 bases</td>
                        <td>≥5 bases</td>
                    </tr>
                </tbody>
            </table>

            <h3>Optimization Strategies</h3>
            <ul>
                <li><strong>Overlap Length:</strong> Balances annealing efficiency (longer) vs. primer cost (shorter). Default target is 20-30 bp.</li>
                <li><strong>Tm Matching:</strong> Core and overlap Tm values should be within 3°C for uniform PCR conditions.</li>
                <li><strong>Fragment Order:</strong> Consider placing GC-rich or longer fragments in middle positions for better assembly.</li>
                <li><strong>Linker Selection:</strong> Use flexible linkers (G4S)n for domains requiring movement, rigid linkers (EAAAK)n for fixed orientations.</li>
            </ul>
        </div>

        <div class="section">
            <h2>Common Issues and Solutions</h2>

            <h3>No Product After Assembly</h3>
            <p><strong>Possible causes:</strong></p>
            <ul>
                <li>Overlap Tm too low or too high</li>
                <li>Insufficient purification of Step 1 products</li>
                <li>Incorrect fragment ratios</li>
            </ul>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Adjust overlap Tm to 55-65°C</li>
                <li>Use gel purification or column cleanup for all fragments</li>
                <li>Use equimolar ratios (calculate based on fragment sizes)</li>
                <li>Increase number of extension cycles in Step 2</li>
            </ul>

            <h3>Multiple Bands or Smear</h3>
            <p><strong>Possible causes:</strong></p>
            <ul>
                <li>Primer dimer formation</li>
                <li>Non-specific amplification</li>
                <li>Incomplete assembly products</li>
            </ul>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Check primer quality scores (avoid "Bad" primers)</li>
                <li>Reduce primer concentration in Step 2</li>
                <li>Use higher annealing temperature (Overlap Tm - 2°C)</li>
                <li>Optimize fragment ratios (excess fragments can cause problems)</li>
            </ul>

            <h3>Low Yield</h3>
            <p><strong>Possible causes:</strong></p>
            <ul>
                <li>Inefficient overlap extension</li>
                <li>Poor template quality</li>
                <li>Suboptimal PCR conditions</li>
            </ul>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Increase fragment concentration in Step 2 mix</li>
                <li>Extend annealing time to 1 minute</li>
                <li>Use high-fidelity polymerase with 3' exonuclease activity</li>
                <li>Add more cycles in final amplification (up to 30 cycles)</li>
            </ul>

            <h3>Wrong Size Product</h3>
            <p><strong>Possible causes:</strong></p>
            <ul>
                <li>Incorrect fragment assembly order</li>
                <li>Missing or duplicated fragments</li>
                <li>Internal priming</li>
            </ul>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Verify all fragments by gel before mixing</li>
                <li>Check sequence compatibility in silico</li>
                <li>Ensure proper fragment purification</li>
                <li>Consider redesigning primers if internal complementarity detected</li>
            </ul>
        </div>

        <div class="section">
            <h2>Best Practices</h2>

            <h3>Before Starting</h3>
            <ul>
                <li>Verify all input sequences are in correct orientation</li>
                <li>Check for unwanted restriction sites in assembled product</li>
                <li>Ensure linker sequences maintain reading frame (if creating fusion proteins)</li>
                <li>Review all primer quality metrics before ordering</li>
            </ul>

            <h3>During PCR</h3>
            <ul>
                <li>Always include positive controls (individual fragments)</li>
                <li>Use high-fidelity polymerase for final assembly</li>
                <li>Maintain consistent template quality across all fragments</li>
                <li>Store purified fragments at -20°C if not used immediately</li>
            </ul>

            <h3>After Assembly</h3>
            <ul>
                <li>Sequence verify the entire assembled product</li>
                <li>Check junction regions carefully for errors</li>
                <li>Clone into vector and verify insert by restriction mapping</li>
                <li>Archive successful primer designs for future use</li>
            </ul>
        </div>

        <div class="section">
            <h2>References and Further Reading</h2>

            <h3>Key Publications</h3>
            <ul>
                <li><strong>Overlap Extension PCR:</strong> Ho SN, et al. (1989) Site-directed mutagenesis by overlap extension using the polymerase chain reaction. Gene 77:51-59.</li>
                <li><strong>Nearest-Neighbor Model:</strong> SantaLucia J Jr. (1998) A unified view of polymer, dumbbell, and oligonucleotide DNA nearest-neighbor thermodynamics. Proc Natl Acad Sci USA 95:1460-1465.</li>
                <li><strong>Primer Design:</strong> Rychlik W, et al. (1990) Optimization of the annealing temperature for DNA amplification in vitro. Nucleic Acids Res 18:6409-6412.</li>
                <li><strong>Codon Usage:</strong> Nakamura Y, et al. (2000) Codon usage tabulated from international DNA sequence databases. Nucleic Acids Res 28:292.</li>
            </ul>

            <h3>Related Techniques</h3>
            <ul>
                <li>Gibson Assembly (isothermal assembly)</li>
                <li>Golden Gate Assembly (Type IIS cloning)</li>
                <li>CPEC (Circular Polymerase Extension Cloning)</li>
                <li>In-Fusion Cloning</li>
            </ul>
        </div>

        <div class="version-info">
            <p>PrimerWeaver OE-PCR Module v1.0.1</p>
            <p>Documentation last updated: December 2024</p>
            <p>© 2024 PrimerWeaver. All rights reserved.</p>
        </div>
    </div>
</body>
</html>